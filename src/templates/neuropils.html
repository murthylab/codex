{% extends "base.html" %} {% block title %} Neuropil Explorer {% endblock title
%} {% block content %}
<script type="module">
  import {
    html,
    Component,
    render,
    useState,
  } from "https://unpkg.com/htm/preact/standalone.module.js";

  const regions = {{ regions | tojson}};
  const region_map = {{ region_map | tojson}};
  console.log(region_map);
  function App() {
    const [selection, setSelection] = useState('{{selected}}');

    return html`
        <div class="card-columns">
              {% for hemisphere in region_map %}
                <div class="card">
                  <summary>{{hemisphere}}</summary>
                  {% for category in region_map[hemisphere] %}
                    <div style="padding-left: 20px" >
                      <summary>{{category}}</summary>
                        {% for region in region_map[hemisphere][category] %}
                          <button onclick=${() => setSelection("{{region}}")} 
                                  style="margin:1px" 
                                  class="${selection == '{{region}}' ? 'btn-success' : 'btn-primary'}">
                            {{region_map[hemisphere][category][region].description}}
                          </button>
                        {% endfor %}
                    </div>
                  {% endfor %}
                </div>
              {% endfor %}
          <div class="card">
                      <p>Search For Neurons:</p>
                    <p>
                    <a href="/app/search?filter_string=output_neuropil+%3D%3D+"${selection} class="btn btn-primary">With this region as output</a>
                    </p>
                    <p>
                    <a href="/app/search?filter_string=input_neuropil+%3D%3D+"${selection} class="btn btn-primary">With this region as input</a>
                    </p>
                    <p>See Neuron Stats</p>
                    <p>
                    <a href="/app/stats?filter_string=output_neuropil+%3D%3D+"${selection} class="btn btn-primary">With this region as output</a>
                    </p>
                    <p>
                    <a href="/app/stats?filter_string=input_neuropil+%3D%3D+"${selection} class="btn btn-primary">With this region as input</a>
                    </p>
        </div>

          <!-- neuroglancer -->
          <div class="card" style="height:500px">
            <div class="card-header" style="color: purple">
              <a href="/app/flywire_neuropil_url?segment_id="${regions[selection][0]} target="_blank"
                >3D Rendering
                <i
                  style="margin-left: 3px"
                  class="fa-sharp fa-solid fa-up-right-from-square"
                ></i
              ></a>
            </div>
            <iframe
              style="width: 98%; height: 100%"
              id="neuroglancer"
              src="/app/flywire_neuropil_url?segment_id="${regions[selection][0]}
              title="neuroglancer"
              loading="lazy"
            ></iframe>
          </div>
        </div>
    `;
  }
  render(html`<${App} />`, document.getElementById("root"));
</script>
<div id="root"></div>

{% endblock content %}
