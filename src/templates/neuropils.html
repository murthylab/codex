{% extends "base.html" %} 

{% block title %} Neuropil Explorer {% endblock title %} 

{% block content %} 
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
	google.charts.load('current', {'packages':['treemap']});
	google.charts.setOnLoadCallback(drawChart);
	chart_data = {{ chart_data |tojson}}
	regions = {{ regions | tojson}}
	console.log('regions', regions)
	console.log('chart_data', chart_data)

	function drawChart() {
		var data = google.visualization.arrayToDataTable(chart_data);
		tree = new google.visualization.TreeMap(document.getElementById('treemap'));
		tree.draw(data);
		function selectHandler() {
			const selectedItem = tree.getSelection();
			if (selectedItem) {
				console.log('selectedItem', selectedItem);
				const region = chart_data[selectedItem[0].row + 1][0];
				const segment_id = regions[region];
				if (segment_id) {
					description = `${region} - ${segment_id[0]}`;
				}
				else {
					description = `${region}`;
				}
				document.getElementById("selected").innerHTML = description;
			}
		}
	google.visualization.events.addListener(tree, 'select', selectHandler);
	window.onresize = drawChart;
	}


</script>
<nav class="navbar navbar-light bg-light">
    <form class="form-inline">
        <input class="form-control mr-sm-2" style="width: 50vw;" autocomplete="off" autofocus type="search"
               id="search" name="search" placeholder="search for brain regions"
               aria-label="Neuropil" value="{{search}}">
        <button class="btn btn btn-primary my-2 my-sm-0" type="submit" onclick="loading();"><i
                class="fa-solid fa-magnifying-glass"></i></button>
    </form>
</nav>

<div class="card-columns" id="main_panels_container" style="padding: 5px;">
<div class="card" style="width: 98%; height:500px">
	<div class='card-header' >
		Explore Regions
	</div>
	<div id='treemap' style='width:100%; height: 450px'></div>
</div>

            <div class="card" style="width: 98%; height: 450px;">
        <div class="card-header" style="color: purple;">
            <a href="{{url_for('app.flywire_url')}}" target="_blank">3D Rendering <i
                    style="margin-left: 3px;" class="fa-sharp fa-solid fa-up-right-from-square"></i></a>
        </div>
        <iframe style="width: 98%; height: 100%;"
                src="{{url_for('app.flywire_url')}}" title="neuroglancer"
                loading="lazy"></iframe>
    </div>
</div>
<p>Currently selected: <span id='selected'></span></p>
<p>Searched: {{search}}</p>

{% endblock content %}
